openapi: 3.0.0
info:
  title: OpenAI Video API
  description: OpenAI Sora 视频生成 API
  version: 1.0.0
servers:
  - url: https://models.kapon.cloud
    description: Kapon 生产环境

security:
  - BearerAuth: []

paths:
  /v1/videos:
    post:
      summary: 创建视频任务
      description: 使用 OpenAI Sora 模型创建视频生成任务
      operationId: createVideo
      tags:
        - Videos
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - model
                - prompt
              properties:
                model:
                  type: string
                  description: 模型名称
                  enum:
                    - sora-2
                    - sora-2-pro
                  example: sora-2
                prompt:
                  type: string
                  description: 视频生成的文本描述，最多 1000 个字符
                  maxLength: 1000
                  example: 百事可乐宣传片
                seconds:
                  type: integer
                  description: 视频时长（秒）。sora-2 支持 4、8、10、12、15 秒，默认 10；sora-2-pro 支持 4、8、12、15、25 秒，默认 15
                  enum:
                    - 4
                    - 8
                    - 10
                    - 12
                    - 15
                    - 25
                  example: 4
                size:
                  type: string
                  description: 视频分辨率
                  enum:
                    - "1280x720"
                    - "1920x1080"
                    - "720x1280"
                    - "1080x1920"
                  default: "1280x720"
                  example: "720x1280"
      responses:
        '200':
          description: 任务创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoObject'
              example:
                id: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
                object: video
                created_at: 1762789802
                status: queued
                model: sora-2
                prompt: 百事可乐宣传片
                progress: 0
                seconds: "4"
                size: "720x1280"
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '429':
          description: 请求频率超限
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/videos/{video_id}:
    get:
      summary: 查询视频任务
      description: 查询指定视频任务的状态和结果
      operationId: getVideo
      tags:
        - Videos
      parameters:
        - name: video_id
          in: path
          required: true
          description: 视频任务的唯一标识符
          schema:
            type: string
          example: video_abc123
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoObject'
              examples:
                processing:
                  summary: 处理中
                  value:
                    id: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
                    object: video
                    created_at: 1762789802
                    status: processing
                    model: sora-2
                    prompt: 百事可乐宣传片
                    progress: 45
                    seconds: "4"
                    size: "720x1280"
                completed:
                  summary: 已完成
                  value:
                    id: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
                    object: video
                    created_at: 1762789802
                    completed_at: 1762789891
                    expires_at: 1762793491
                    status: completed
                    model: sora-2
                    prompt: 百事可乐宣传片
                    progress: 100
                    seconds: "4"
                    size: "720x1280"
        '404':
          description: 视频任务不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    delete:
      summary: 删除视频任务
      description: 删除指定的视频任务及其资源
      operationId: deleteVideo
      tags:
        - Videos
      parameters:
        - name: video_id
          in: path
          required: true
          description: 视频任务的唯一标识符
          schema:
            type: string
          example: video_abc123
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
                  object:
                    type: string
                    example: video
                  deleted:
                    type: boolean
                    example: true
              example:
                id: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
                object: video
                deleted: true
        '404':
          description: 视频任务不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/videos/{video_id}/content:
    get:
      summary: 下载视频内容
      description: 下载生成的视频文件
      operationId: downloadVideo
      tags:
        - Videos
      parameters:
        - name: video_id
          in: path
          required: true
          description: 视频任务的唯一标识符
          schema:
            type: string
          example: video_abc123
      responses:
        '200':
          description: 视频文件
          content:
            video/mp4:
              schema:
                type: string
                format: binary
        '404':
          description: 视频任务不存在或未完成
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '410':
          description: 视频已过期
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v1/videos/{video_id}/remix:
    post:
      summary: Remix 视频
      description: 基于现有视频进行二次创作
      operationId: remixVideo
      tags:
        - Videos
      parameters:
        - name: video_id
          in: path
          required: true
          description: 原视频任务的唯一标识符
          schema:
            type: string
          example: video_abc123
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - prompt
              properties:
                prompt:
                  type: string
                  description: Remix 的文本描述
                  maxLength: 1000
                  example: 在结尾添加品牌 Logo
      responses:
        '200':
          description: Remix 任务创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoObject'
              example:
                id: video_def456789abc012345678901234567890123456789
                object: video
                created_at: 1762789902
                status: queued
                model: sora-2
                prompt: 在结尾添加品牌 Logo
                progress: 0
                seconds: "4"
                size: "720x1280"
                parent_video_id: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
        '404':
          description: 原视频任务不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 使用 API Key 作为 Bearer Token

  schemas:
    VideoObject:
      type: object
      properties:
        id:
          type: string
          description: 视频任务的唯一标识符
          example: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
        object:
          type: string
          description: 对象类型
          enum:
            - video
          example: video
        created_at:
          type: integer
          description: 创建时间戳（Unix 时间）
          example: 1762789802
        completed_at:
          type: integer
          description: 任务完成时间戳（仅在 completed 状态下存在）
          example: 1762789891
        expires_at:
          type: integer
          description: 视频过期时间戳（仅在 completed 状态下存在）
          example: 1762793491
        model:
          type: string
          description: 使用的模型名称
          example: sora-2
        status:
          type: string
          description: 任务状态
          enum:
            - queued
            - processing
            - completed
            - failed
          example: queued
        prompt:
          type: string
          description: 生成视频的文本描述
          example: 一个无人机从海滩升空拍摄夕阳
        progress:
          type: integer
          description: 处理进度（0-100）
          minimum: 0
          maximum: 100
          example: 0
        seconds:
          type: string
          description: 视频时长（字符串格式）
          example: "10"
        size:
          type: string
          description: 视频分辨率
          example: "1280x720"
        assets:
          type: array
          description: 生成的视频资源数组，仅在 completed 状态下存在（部分供应商可能不返回此字段，需通过 /content 端点下载）
          items:
            $ref: '#/components/schemas/VideoAsset'
        parent_video_id:
          type: string
          description: 父视频 ID（仅 Remix 任务返回）
          example: video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737
        error:
          type: object
          description: 错误信息，仅在 failed 状态下存在
          properties:
            code:
              type: string
              example: generation_failed
            message:
              type: string
              example: 视频生成失败，请重试

    VideoAsset:
      type: object
      properties:
        url:
          type: string
          description: 视频文件 URL
          example: https://cdn.example.com/video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737.mp4
        quality:
          type: string
          description: 视频质量/分辨率
          example: "1280x720"
        duration:
          type: integer
          description: 视频时长（秒）
          example: 10
        size_bytes:
          type: integer
          description: 文件大小（字节）
          example: 5242880

    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            message:
              type: string
              description: 错误描述
              example: Invalid request parameters
            type:
              type: string
              description: 错误类型
              example: invalid_request_error
            code:
              type: string
              description: 错误代码
              example: invalid_parameters
