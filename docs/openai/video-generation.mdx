---
title: "视频生成"
description: "通过 kapon 代理调用 OpenAI Sora 视频生成接口"
openapi: "POST /v1/videos"
---

使用 OpenAI Sora 模型生成视频内容。kapon 支持完整的视频生成工作流，包括任务创建、状态查询和内容下载。

## 创建视频任务

通过提供文本提示词来生成视频：

```bash
curl -X POST "https://models.kapon.cloud/v1/videos" \
  -H "Authorization: Bearer $TOKEN" \
  -F "model=sora-2" \
  -F "prompt=百事可乐宣传片" \
  -F "seconds=4" \
  -F "size=720x1280"
```

### 请求参数

- `model`：模型名称，支持 `sora-2` 和 `sora-2-pro`
- `prompt`：视频生成的文本描述
- `seconds`：视频时长（秒，字符串传递更兼容），仅支持 `4`、`8`、`12`，默认 `4`
- `size`：视频分辨率，如 `1280x720`、`1920x1080`

<Callout type="tip">
仅支持 4/8/12 秒。较短的视频时长（4、8、12 秒）可以更快生成，适合快速预览或短视频场景。
</Callout>

### 响应示例

```json
{
  "id": "video_691209aab0a08198a4e78870277f7e3d0215e09cec47a737",
  "object": "video",
  "created_at": 1762789802,
  "status": "queued",
  "model": "sora-2",
  "prompt": "百事可乐宣传片",
  "progress": 0,
  "seconds": "4",
  "size": "720x1280"
}
```

## 状态说明

任务创建后会经历以下状态：

- `queued`：任务已排队，等待处理
- `processing`：正在生成视频
- `completed`：生成完成，可以下载视频
- `failed`：生成失败

<Callout type="info">
任务完成后，响应会包含 `completed_at`（完成时间）和 `expires_at`（过期时间）字段。视频文件会在过期时间后自动删除。
</Callout>

## 完整示例

创建任务并等待完成：

```bash
# 1. 创建视频任务
RESPONSE=$(curl -X POST "https://models.kapon.cloud/v1/videos" \
  -H "Authorization: Bearer $TOKEN" \
  -F "model=sora-2" \
  -F "prompt=百事可乐宣传片" \
  -F "seconds=4" \
  -F "size=720x1280")

VIDEO_ID=$(echo $RESPONSE | jq -r '.id')
echo "视频任务 ID: $VIDEO_ID"

# 2. 轮询查询状态
while true; do
  RESPONSE=$(curl "https://models.kapon.cloud/v1/videos/$VIDEO_ID" \
    -H "Authorization: Bearer $TOKEN")
  
  STATUS=$(echo $RESPONSE | jq -r '.status')
  PROGRESS=$(echo $RESPONSE | jq -r '.progress')
  
  echo "当前状态: $STATUS (进度: $PROGRESS%)"
  
  if [ "$STATUS" = "completed" ]; then
    echo "✓ 视频生成完成"
    break
  elif [ "$STATUS" = "failed" ]; then
    echo "✗ 视频生成失败"
    exit 1
  fi
  
  sleep 5
done

# 3. 下载视频
curl -L "https://models.kapon.cloud/v1/videos/$VIDEO_ID/content" \
  -H "Authorization: Bearer $TOKEN" \
  --output "${VIDEO_ID}.mp4"

echo "✓ 视频已保存到 ${VIDEO_ID}.mp4"
```

<Callout type="info">
kapon 会对不同供应商的返回结构进行统一封装，`status` 字段取值为 `queued`、`processing`、`completed`、`failed` 等。视频完成后会包含 `completed_at` 和 `expires_at` 时间戳。
</Callout>

### 脚本示例（Python，本地文件参考图）

仓库提供了基于 openai Python SDK 的本地验证脚本，可通过 `input_reference` 上传参考图并自动轮询与下载：

```bash
export OPENAI_BASE_URL="https://models.kapon.cloud/v1"
export OPENAI_API_KEY="$TOKEN"

python3 scripts/sora2_image_to_video_sdk.py \
  --prompt "百事可乐宣传片" \
  --seconds 4 \
  --size 720x1280 \
  --image /absolute/path/to/ref.jpg \
  --output sora_video.mp4
```


## 参考图生视频（Image-to-Video）

除纯文本生视频外，kapon 也支持“带参考图”的视频生成。按照 OpenAI Sora 的接口规范，在创建任务时以 multipart/form-data 方式上传参考图文件字段 `input_reference`。

### curl 示例（multipart）

```bash
curl -X POST "https://models.kapon.cloud/v1/videos" \
  -H "Authorization: Bearer $TOKEN" \
  -F "model=sora-2" \
  -F "prompt=百事可乐宣传片，都市街拍风，年轻活力，镜头运动丰富" \
  -F "seconds=4" \
  -F "size=720x1280" \
  -F "input_reference=@/absolute/path/to/ref.jpg"
```

<Callout type="warning">
部分上游（如 ezlinkai）对 `seconds` 有严格要求：必须是 4、8 或 12 且必须在 multipart 中显式出现。请确保 `-F seconds=4` 使用的是纯数字，不要加引号，也不要误用 Bash/Zsh 的保留变量 `SECONDS`。
</Callout>

### Python SDK 示例（openai-python）

```python
from openai import OpenAI

client = OpenAI(
    base_url="https://models.kapon.cloud/v1",
    api_key="$TOKEN",
)

with open("./ref.jpg", "rb") as f:
    job = client.videos.create(
        model="sora-2",
        prompt="百事可乐宣传片，都市街拍风，年轻活力，镜头运动丰富",
        seconds="4",          # 以字符串传递更兼容
        size="720x1280",
        input_reference=f,     # 关键：参考图文件
    )

print("任务ID:", job.id, "状态:", job.status)

# 轮询
import time
while True:
    cur = client.videos.retrieve(job.id)
    print("状态:", cur.status, "进度:", getattr(cur, "progress", None))
    if cur.status in ("completed", "failed"):
        job = cur
        break
    time.sleep(2)

if job.status == "completed":
    content = client.videos.download_content(job.id)
    content.write_to_file("output.mp4")
    print("已保存到 output.mp4")
else:
    print("生成失败:", getattr(job, "error", None))
```

<Callout type="tip">
本仓库已提供两个可执行脚本便于本地验证：
- curl 版本：`scripts/validate_image2video.sh`（自动下载示例参考图、轮询并下载成片）
- SDK 版本：`scripts/sora2_image_to_video_sdk.py`（基于 openai Python SDK，支持 `--image/--seconds/--size` 参数）
</Callout>
