---
title: "Python SDK ç¤ºä¾‹"
description: "ä½¿ç”¨ Python è°ƒç”¨è§†é¢‘ç”Ÿæˆæ¥å£çš„å®Œæ•´ç¤ºä¾‹ï¼ˆå« openai-python SDK è½®è¯¢ä¸ä¸‹è½½ï¼‰"
---

æœ¬æ–‡æ¡£æä¾›ä½¿ç”¨ Python è°ƒç”¨è§†é¢‘ç”Ÿæˆæ¥å£çš„å®Œæ•´ç¤ºä¾‹ä»£ç ã€‚

## æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ openai-python SDKï¼ˆæ¨èï¼‰

### ä¾èµ–å®‰è£…

```bash
pip install openai
```

### å®Œæ•´ç¤ºä¾‹ä»£ç ï¼ˆåˆ›å»ºä»»åŠ¡ + è½®è¯¢çŠ¶æ€ + ä¸‹è½½è§†é¢‘ï¼‰

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä½¿ç”¨ openai-python SDK è°ƒç”¨ /v1/videosï¼šåˆ›å»ºä»»åŠ¡ + è½®è¯¢çŠ¶æ€ + ä¸‹è½½è§†é¢‘

æ³¨æ„ï¼š
- å»ºè®®é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥å¯†é’¥/ç«¯ç‚¹ï¼Œé¿å…æŠŠå¯†é’¥å†™è¿›ä»£ç ï¼š
  - OPENAI_API_KEY
  - OPENAI_BASE_URLï¼ˆé»˜è®¤ https://models.kapon.cloud/v1ï¼‰
- å¯¹æ¥æœ¬é¡¹ç›®çš„ Sora é€šé“æ—¶ï¼Œsora-2 å¸¸è§åˆæ³•ç§’æ•°ï¼š10 æˆ– 15ï¼ˆæŒ‰ä¸Šæ¸¸ä¾›åº”å•†è¦æ±‚ï¼‰ã€‚
"""

import os
import sys
import time
from openai import OpenAI


def main():
    base_url = os.getenv("OPENAI_BASE_URL", "https://models.kapon.cloud/v1")
    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        print("è¯·è®¾ç½® OPENAI_API_KEY ç¯å¢ƒå˜é‡ã€‚", file=sys.stderr)
        sys.exit(1)

    client = OpenAI(base_url=base_url, api_key=api_key)

    # ä¸šåŠ¡å‚æ•°ï¼ˆå¯é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ï¼‰
    prompt = os.getenv("SORA_PROMPT", "A cat playing with a ball of yarn")
    model = os.getenv("SORA_MODEL", "sora-2")
    # åç«¯å¯¹ seconds ä½¿ç”¨äº† Go çš„ `,string` ååºåˆ—åŒ–æ ‡ç­¾ï¼Œéœ€ä»¥å­—ç¬¦ä¸²ä¼ é€’
    seconds = os.getenv("SORA_SECONDS", "10")  # sora-2 å¸¸ç”¨ 10 æˆ– 15
    try:
        seconds = str(int(seconds))
    except Exception:
        pass
    size = os.getenv("SORA_SIZE", "720x1280")
    output = os.getenv("SORA_OUTPUT", "sora_video.mp4")

    print("ğŸ¬ æäº¤ç”Ÿæˆä»»åŠ¡â€¦")
    print(f"ğŸ“ prompt: {prompt}")
    print(f"ğŸ¯ model:  {model}")
    print(f"â±ï¸ seconds: {seconds}")
    print(f"ğŸ“ size:    {size}")

    # 1) åˆ›å»ºä»»åŠ¡
    try:
        job = client.videos.create(
            prompt=prompt,
            model=model,
            seconds=seconds,  # ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ é€’
            size=size,
        )
    except Exception as e:
        print(f"âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: {e}", file=sys.stderr)
        sys.exit(2)

    print(f"ğŸ“¦ ä»»åŠ¡å·²åˆ›å»º: {job.id} | çŠ¶æ€: {job.status}")

    # 2) è½®è¯¢çŠ¶æ€ï¼ˆæ‰“å°è¿›åº¦ï¼‰
    last_status = None
    while True:
        try:
            cur = client.videos.retrieve(job.id)
        except Exception as e:
            print(f"âš ï¸  è½®è¯¢å¤±è´¥ï¼Œé‡è¯•ä¸­: {e}")
            time.sleep(2.0)
            continue

        status = cur.status
        progress = getattr(cur, "progress", None)
        if status != last_status or progress is not None:
            if progress is not None:
                print(f"â³ çŠ¶æ€: {status} | è¿›åº¦: {progress}%")
            else:
                print(f"â³ çŠ¶æ€: {status}")
            last_status = status

        if status in ("completed", "failed"):
            job = cur
            break

        time.sleep(2.0)

    # 3) ä¸‹è½½è§†é¢‘å†…å®¹
    if job.status == "completed":
        try:
            print("ğŸ“¥ å¼€å§‹ä¸‹è½½è§†é¢‘â€¦")
            content = client.videos.download_content(job.id)
            content.write_to_file(output)
            print(f"âœ… å·²ä¿å­˜åˆ°: {output}")
        except Exception as e:
            print(f"âŒ ä¸‹è½½å¤±è´¥: {e}", file=sys.stderr)
            sys.exit(3)
    else:
        err = getattr(job, "error", None)
        print(f"âŒ ä»»åŠ¡å¤±è´¥: {err}", file=sys.stderr)
        sys.exit(4)


if __name__ == "__main__":
    main()
```

### ä½¿ç”¨è¯´æ˜

```bash
export OPENAI_API_KEY="your-api-key"
export OPENAI_BASE_URL="https://models.kapon.cloud/v1"   # å¯çœç•¥

# ä¸šåŠ¡å‚æ•°ï¼ˆå¯é€‰ï¼‰
export SORA_PROMPT="A cat playing with a ball of yarn"
export SORA_MODEL="sora-2"
export SORA_SECONDS="10"          # sora-2 å»ºè®® 10 æˆ– 15ï¼›ä»¥å­—ç¬¦ä¸²ä¼ é€’
export SORA_SIZE="720x1280"
export SORA_OUTPUT="./my_video.mp4"

python video_generation_sdk.py
```

æ³¨æ„äº‹é¡¹
- `seconds` éœ€ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ å…¥ï¼ˆæœåŠ¡ç«¯ä½¿ç”¨ Go çš„ `,string` æ ‡ç­¾è¿›è¡Œååºåˆ—åŒ–ï¼‰ã€‚
- æ¨¡å‹ä¸ç§’æ•°å—ä¸Šæ¸¸ä¾›åº”å•†é™åˆ¶ï¼š
  - `sora-2`ï¼šå¸¸è§ 10 æˆ– 15 ç§’
  - `sora-2-pro`ï¼šå¸¸è§ 15 æˆ– 25 ç§’
- ä»»åŠ¡å®Œæˆåä¹Ÿå¯ä»¥ä½¿ç”¨ `download_content(video_id, variant="thumbnail")` è·å–ç¼©ç•¥å›¾ç­‰å˜ä½“ã€‚
- å®Œæ•´è„šæœ¬å‚è€ƒï¼š`scripts/sora2_text_to_video_sdk.py`

---

## æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ requests ç›´è°ƒï¼ˆmultipart/form-dataï¼‰

> ä¿ç•™æ—§æ–¹æ¡ˆï¼Œé€‚åˆéœ€è¦å®Œå…¨æ§åˆ¶ HTTP æŠ¥æ–‡æˆ–è°ƒè¯• multipart çš„åœºæ™¯ã€‚

### ä¾èµ–å®‰è£…

```bash
pip install requests
```

### å®Œæ•´ç¤ºä¾‹ä»£ç 

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è§†é¢‘ç”Ÿæˆ API - Python ç¤ºä¾‹è„šæœ¬
ä½¿ç”¨ /v1/videos æ¥å£åˆ›å»ºè§†é¢‘ç”Ÿæˆä»»åŠ¡ï¼Œå¹¶è½®è¯¢ä»»åŠ¡çŠ¶æ€ç›´è‡³å®Œæˆã€‚
"""

import os
import time
import json
from typing import Optional

import requests


def _get_attr(obj, name, default=None):
    """å®‰å…¨è¯»å–å±æ€§/é”®ï¼Œå…¼å®¹å¯¹è±¡æˆ–å­—å…¸ã€‚"""
    if obj is None:
        return default
    if hasattr(obj, name):
        try:
            return getattr(obj, name)
        except Exception:
            pass
    if isinstance(obj, dict):
        return obj.get(name, default)
    return default


def generate_video(
    prompt: str,
    api_key: Optional[str] = None,
    base_url: Optional[str] = None,
    model: str = "sora-2",
    seconds: int = 4,
    size: str = "720x1280",
    poll_interval_sec: float = 2.0,
) -> Optional[str]:
    """
    åˆ›å»ºè§†é¢‘ç”Ÿæˆä»»åŠ¡å¹¶è½®è¯¢ç›´è‡³å®Œæˆã€‚

    å‚æ•°:
        prompt: æ–‡æœ¬æç¤ºè¯
        api_key: API Keyï¼ˆé»˜è®¤ä» OPENAI_API_KEY ç¯å¢ƒå˜é‡è¯»å–ï¼‰
        base_url: API ç«¯ç‚¹åœ°å€
        model: æ¨¡å‹åç§°ï¼Œé»˜è®¤ 'sora-2'
        seconds: è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 4
        size: åˆ†è¾¨ç‡å­—ç¬¦ä¸²ï¼Œå¦‚ '720x1280'
        poll_interval_sec: è½®è¯¢é—´éš”ç§’æ•°

    è¿”å›:
        æˆåŠŸ: è§†é¢‘ URL
        å¤±è´¥: None
    """
    key = api_key or os.getenv("OPENAI_API_KEY")
    if not key:
        raise ValueError("è¯·è®¾ç½® OPENAI_API_KEY ç¯å¢ƒå˜é‡æˆ–ä¼ å…¥ api_key å‚æ•°")
    
    base = base_url or os.getenv("OPENAI_BASE_URL") or "https://api.openai.com/v1"

    print("ğŸ¬ å¼€å§‹æäº¤ç”Ÿæˆä»»åŠ¡...")
    print(f"ğŸ“ æç¤ºè¯: {prompt}")
    print(f"ğŸ¯ æ¨¡å‹: {model}")
    print(f"â±ï¸  æ—¶é•¿: {seconds}s")
    print(f"ğŸ“ åˆ†è¾¨ç‡: {size}")
    print()

    # 1) åˆ›å»ºè§†é¢‘ç”Ÿæˆä»»åŠ¡
    url_create = base.rstrip("/") + "/videos"
    headers = {"Authorization": f"Bearer {key}"}
    files = {
        "model": (None, model),
        "prompt": (None, prompt),
        "seconds": (None, str(int(seconds))),
        "size": (None, size),
    }
    
    try:
        resp = requests.post(url_create, headers=headers, files=files, timeout=60)
        if resp.status_code >= 400:
            print(f"âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: {resp.status_code} {resp.reason}")
            try:
                print(json.dumps(resp.json(), ensure_ascii=False, indent=2))
            except Exception:
                print(resp.text)
            return None
        job = resp.json()
    except Exception as e:
        print(f"âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: {e}")
        return None

    job_id = _get_attr(job, "id")
    status = _get_attr(job, "status")
    if not job_id:
        print(f"âŒ åˆ›å»ºå“åº”ç¼ºå°‘ä»»åŠ¡ID: {job}")
        return None
    print(f"ğŸ“¦ ä»»åŠ¡å·²åˆ›å»º: {job_id} (çŠ¶æ€: {status})")

    # 2) è½®è¯¢ä»»åŠ¡çŠ¶æ€ç›´è‡³å®Œæˆ/å¤±è´¥
    url_retrieve = base.rstrip("/") + f"/videos/{job_id}"
    last_status = None
    
    while True:
        try:
            r = requests.get(url_retrieve, headers=headers, timeout=60)
            if r.status_code >= 400:
                print(f"âš ï¸  è½®è¯¢å¤±è´¥: {r.status_code}")
                time.sleep(max(1.0, poll_interval_sec))
                continue
            cur = r.json()
        except Exception as e:
            print(f"âš ï¸  è½®è¯¢å¤±è´¥ï¼Œç¨åé‡è¯•: {e}")
            time.sleep(max(1.0, poll_interval_sec))
            continue

        status = (_get_attr(cur, "status") or "").lower()
        progress = _get_attr(cur, "progress")
        
        if status != last_status or progress is not None:
            msg = f"â³ çŠ¶æ€: {status or 'unknown'}"
            if progress is not None:
                try:
                    msg += f" | è¿›åº¦: {int(progress)}%"
                except Exception:
                    msg += f" | è¿›åº¦: {progress}"
            print(msg)
            last_status = status

        if status in ("completed",):
            video_url = _get_attr(cur, "video_url")
            if video_url:
                print("\nâœ… è§†é¢‘ç”Ÿæˆå®Œæˆï¼")
                print(f"ğŸ”— è§†é¢‘é“¾æ¥: {video_url}")
                return video_url
            print("\nâš ï¸ å®Œæˆä½†æœªè·å–åˆ°è§†é¢‘é“¾æ¥ã€‚")
            return None

        if status in ("failed", "error"):
            err = _get_attr(cur, "error")
            print(f"\nâŒ ä»»åŠ¡å¤±è´¥: {err}")
            return None

        time.sleep(max(1.0, poll_interval_sec))


def download_video(video_url: str, save_path: str = "./video.mp4") -> bool:
    """
    ä¸‹è½½è§†é¢‘åˆ°æœ¬åœ°

    å‚æ•°:
        video_url: è§†é¢‘ URL
        save_path: ä¿å­˜è·¯å¾„

    è¿”å›:
        True/False
    """
    try:
        print("\nğŸ“¥ å¼€å§‹ä¸‹è½½è§†é¢‘...")
        with requests.get(video_url, stream=True, timeout=300) as resp:
            resp.raise_for_status()
            with open(save_path, "wb") as f:
                for chunk in resp.iter_content(chunk_size=8192):
                    if chunk:
                        f.write(chunk)
        print(f"âœ… è§†é¢‘å·²ä¿å­˜åˆ°: {save_path}")
        return True
    except Exception as e:
        print(f"âŒ ä¸‹è½½å¤±è´¥: {e}")
        return False


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # è®¾ç½® API Key å’Œç«¯ç‚¹
    API_KEY = os.getenv("OPENAI_API_KEY", "your-api-key")
    BASE_URL = os.getenv("OPENAI_BASE_URL", "https://api.openai.com/v1")

    # ç”Ÿæˆè§†é¢‘
    prompt = "A cat playing with a ball of yarn"
    url = generate_video(
        prompt,
        api_key=API_KEY,
        base_url=BASE_URL,
        model="sora-2",
        seconds=10,
        size="720x1280",
    )

    # ä¸‹è½½è§†é¢‘
    if url:
        download_video(url, save_path="./my_video.mp4")
```

### ä½¿ç”¨è¯´æ˜ä¸æ³¨æ„äº‹é¡¹

- ç¯å¢ƒå˜é‡åŒä¸Šï¼Œå°† `OPENAI_BASE_URL` æŒ‡å‘ä½ çš„ç«¯ç‚¹ï¼ˆé»˜è®¤ `https://models.kapon.cloud/v1`ï¼‰ã€‚
- è¯¥ç¤ºä¾‹ä½¿ç”¨ `multipart/form-data` æäº¤ï¼ˆè¡¨å•å­—æ®µï¼š`model/prompt/seconds/size`ï¼‰ã€‚
- å®Œæ•´è„šæœ¬å‚è€ƒï¼š`scripts/sora2_text_to_video.py`
