# 供应商定价系统

## Why

当前系统只有全局的品牌模型官方价格（Price表）和用户组倍率（UserGroup.ratio），无法满足以下业务需求：

1. **多供应商管理**：无法记录和管理不同上游供应商的信息
2. **采购成本不透明**：无法记录供应商的采购折扣，导致成本核算困难
3. **质量档位缺失**：同一供应商对同一模型可能提供不同质量档位（premium/standard/economy），当前无法区分
4. **渠道归属不清**：Channel 表无法关联到具体供应商，管理混乱
5. **定价策略单一**：只能通过 UserGroup.ratio 统一调价，无法针对特定模型或质量档位精细化定价

这导致：
- 无法准确计算利润（售价 - 采购成本）
- 无法根据质量要求路由到合适的供应商渠道
- 无法为不同客户提供差异化定价策略

## What Changes

### 新增功能

1. **供应商管理模块**
   - 新增 Supplier 表：记录上游供应商基本信息
   - 新增 SupplierModel 表：记录供应商的模型配置（采购折扣、质量档位、渠道类型）
   - 新增 CustomerPricing 表（可选）：支持客户精细化定价策略

2. **扩展现有表**
   - Channel 表增加 `supplier_id` 和 `quality_tier` 字段
   - 保持 Price 表不变（作为品牌官方价格基准）
   - 保持 UserGroup 表不变（ratio 作为默认销售倍率）

3. **定价计算逻辑**
   - 采购成本 = 官方价格 × 供应商采购折扣
   - 客户售价 = 官方价格 × 客户销售折扣（基于官方价，不是采购成本）
   - 利润 = 客户售价 - 采购成本

4. **路由增强**
   - 支持根据质量档位筛选渠道
   - 支持根据供应商优先级选择渠道

### 数据模型

```
Price (品牌官方价) → 基准价格
    ↓
Supplier (供应商) → 供应商信息
    ↓
SupplierModel (供应商模型配置) → 采购折扣 + 质量档位
    ↓
Channel (渠道实例) → 关联供应商 + 质量档位
    ↓
UserGroup / CustomerPricing → 客户销售折扣
```

## Impact

### 受影响的模块

- **model/supplier.go**（新增）：供应商相关数据模型和 CRUD
- **model/channel.go**（修改）：增加 supplier_id 和 quality_tier 字段
- **model/pricing.go**（修改）：价格计算逻辑需要考虑供应商折扣
- **model/migrate.go**（修改）：数据库迁移脚本
- **路由模块**（修改）：根据质量档位和供应商选择渠道
- **计费模块**（修改）：计算采购成本和利润

### 向后兼容性

- **兼容**：现有 Channel 不关联供应商时，使用默认逻辑
- **兼容**：现有 UserGroup.ratio 继续生效
- **兼容**：Price 表保持不变，作为基准价

### 数据迁移

- 为现有 Channel 表增加可空字段 `supplier_id` 和 `quality_tier`
- 不影响现有数据，新字段默认为 NULL

## Benefits

1. **成本透明**：清晰记录采购成本，便于利润分析
2. **质量分级**：支持不同质量档位，满足不同客户需求
3. **精细定价**：支持针对特定模型、质量档位的差异化定价
4. **供应商管理**：统一管理上游供应商信息和配置
5. **路由优化**：根据质量要求和供应商优先级智能路由
