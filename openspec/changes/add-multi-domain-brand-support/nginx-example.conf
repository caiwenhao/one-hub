# Kapon AI（默认品牌）- 保持原有配置
server {
    listen 80;
    server_name models.kapon.cloud;
    
    # 原有配置保持不变
    # 这里是示例，实际配置根据现有部署调整
    
    location / {
        # 前端静态资源或反向代理配置
        root /var/www/kapon;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://localhost:3000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    location /panel {
        # 管理后台
        root /var/www/kapon;
        try_files $uri $uri/ /panel/index.html;
    }
}

# Grouplay AI（新品牌）- 新增配置
server {
    listen 80;
    server_name model.grouplay.cn;
    
    # 前端静态资源（基于 Kapon AI 克隆，移除了 panel）
    location / {
        root /var/www/grouplay;
        try_files $uri $uri/ /index.html;
    }
    
    # API 反向代理到 Kapon AI 后端
    # 重要：传递 Host 头，让后端识别品牌
    location /api/ {
        proxy_pass http://kapon-backend-server:3000/api/;
        proxy_set_header Host $host;  # 传递 model.grouplay.cn
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # 管理后台反向代理到 Kapon AI
    # 注意：这里使用 Kapon AI 的域名作为 Host
    location /panel {
        proxy_pass http://kapon-server/panel;
        proxy_set_header Host models.kapon.cloud;  # 使用 Kapon AI 域名
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 如果需要重写 Cookie 域名
        proxy_cookie_domain models.kapon.cloud model.grouplay.cn;
    }
}

# HTTPS 配置示例（推荐生产环境使用）
server {
    listen 443 ssl http2;
    server_name model.grouplay.cn;
    
    ssl_certificate /path/to/ssl/cert.pem;
    ssl_certificate_key /path/to/ssl/key.pem;
    
    # 其他配置同上
    location / {
        root /var/www/grouplay;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://kapon-backend-server:3000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /panel {
        proxy_pass https://models.kapon.cloud/panel;
        proxy_set_header Host models.kapon.cloud;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cookie_domain models.kapon.cloud model.grouplay.cn;
    }
}

# HTTP 重定向到 HTTPS
server {
    listen 80;
    server_name model.grouplay.cn;
    return 301 https://$server_name$request_uri;
}
